specVersion: "1.0"
meta:
  name: agri-Culture-Intelligence
  description: "Enterprise RAG for Phase I Orchard Operations on DGX Spark"

environment:
  base:
    image: nvcr.io/nvidia/workbench/workbench-base-ubuntu22.04:latest
  
  # This section defines the 'Sidecar' containers (your NIMs)
  compose:
    services:
      llm-nim:
        image: "nvcr.io/nim/meta/llama-3.1-8b-instruct:latest"
        environment:
          - NGC_API_KEY=${NGC_API_KEY}
          - NIM_DISABLE_CUDA_GRAPH=1
          - NIM_VLLM_FLAGS=--enforce-eager
        ports:
          - "8000:8000"
        deploy:
          resources:
            reservations:
              devices:
                - driver: nvidia
                  count: 1
                  capabilities: [gpu]

      embed-nim:
        image: "nvcr.io/nim/nvidia/llama-3.2-nemoretriever-300m-embed-v1:latest"
        environment:
          - NGC_API_KEY=${NGC_API_KEY}
          - NIM_DISABLE_CUDA_GRAPH=1
        ports:
          - "8001:8000"
        deploy:
          resources:
            reservations:
              devices:
                - driver: nvidia
                  count: 1
                  capabilities: [gpu]

execution:
  apps:
    - name: JupyterLab
      type: webapp
      port: 8888
      startCommand: jupyter lab --ip 0.0.0.0 --port 8888 --no-browser --allow-root
